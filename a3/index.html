<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <title>It's a me, mario</title>
    <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/milligram@1.3.0/dist/milligram.min.css">
    <style type="text/css">
        div.tooltip {	
            position: absolute;			
            text-align: center;			
            width: auto;					
            height: auto;					
            padding: 5px;				
            font: 12px sans-serif;		
            background: lightsteelblue;	
            border: 0px;		
            border-radius: 8px;			
            pointer-events: none;			
        }
        .legendCells {
            transform: translate(300px, -350px);
            font-size: 12px;
            
        }
    </style>
</head>
<body>
    <h1>Top Video Games by Units Sold</h1>
	<script type="text/javascript">

        // Define the div for the tooltip
        var tooltip = d3.select("body").append("div")	
            .attr("class", "tooltip")				
            .style("opacity", 0);

        // Define the legend
        var legendOrdinal;

        d3.csv("vgsales.csv", function(error, data) {
            data.forEach(function(d) {
                d.Rank = +d.Rank;
                d.Year = +d.Year;
                d.Value = +d.Global_Sales;
                d.NA_Sales = +d.NA_Sales;
                d.EU_Sales = +d.EU_Sales;
                d.JP_Sales = +d.JP_Sales;
                d.Other_Sales = +d.Other_Sales;
                d.Global_Sales = +d.Global_Sales;
            });
            
            dataset = {children: data}

            var diameter = 800;
            var color = d3.scaleOrdinal().range(['#f44242', '#52b043','#0099e5','#ff9900','#9f7ded']);

            var bubble = d3.pack(dataset)
                .size([diameter, diameter])
                .padding(1.5);

            var svg = d3.select("body")
                .append("svg")
                .attr("width", diameter)
                .attr("height", diameter)
                .attr("class", "bubble");

            var nodes = d3.hierarchy(dataset)
                .sum(function(d) { return d.Global_Sales; });

            var node = svg.selectAll(".node")
                .data(bubble(nodes).descendants())
                .enter()
                .filter(function(d){
                    return  !d.children
                })
                .append("g")
                .attr("class", "node")
                .attr("transform", function(d) {
                    return "translate(" + d.x + "," + d.y + ")";
                });
            

            node.append("circle")
            .attr("r", function(d) {
                return d.r;
            })
            .style("fill", function(d) {
                return color(d.data.Publisher);
            })
            .on("mouseover", function(d) {	
                // Display tooltip
                tooltip.transition()		
                    .duration(200)		
                    .style("opacity", .9);		
                // Add information to tooltip
                tooltip.html(d.data.Name + "<br/>"  + d.data.Platform + "<br/>"  + d.data.Global_Sales + "M copies<br />" +  d.data.Year)	
                    .style("left", (d3.event.pageX) + "px")		
                    .style("top", (d3.event.pageY - 28) + "px");	
            })					
            .on("mouseout", function(d) {
                // Hide tooltip		
                tooltip.transition()		
                    .duration(500)		
                    .style("opacity", 0);	
            });

            node.append("text")
                .attr("dy", ".2em")
                .style("text-anchor", "middle")
                .text(function(d) {
                    return d.data.Name.substring(0, d.r / 3);
                })
                .attr("font-family", "sans-serif")
                .attr("font-size", function(d){
                    return d.r/5;
                })
                .attr("fill", "white");

            node.append("text")
                .attr("dy", "1.3em")
                .style("text-anchor", "middle")
                .text(function(d) {
                    return '#' + d.data.Rank;
                })
                .attr("font-family",  "Gill Sans", "Gill Sans MT")
                .attr("font-size", function(d){
                    return d.r/5;
                })
                .attr("fill", "white");

            d3.select(self.frameElement)
                .style("height", diameter + "px");

            // Define the color legend
            legendOrdinal = d3.legendColor()
                .scale(color)
                .shape('circle')

            svg.select("g.node")
                .call(legendOrdinal);

        });

	</script>
</body>
</html>